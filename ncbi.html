<!DOCTYPE html>
<html>
<head>
  <title>NCBI database update</title>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/spinner.css">
    <script type="text/javascript" src="js/menu.js"></script>
    <script type="text/javascript" src="js/functions.js"></script>
    <script type="text/javascript" src="js/adds.js"></script>
    <div id="ballsWaveG" class="overlay">
       <div id="ballsWaveG_1" class="ballsWaveG"></div>
       <div id="ballsWaveG_2" class="ballsWaveG"></div>
       <div id="ballsWaveG_3" class="ballsWaveG"></div>
       <div id="ballsWaveG_4" class="ballsWaveG"></div>
       <div id="ballsWaveG_5" class="ballsWaveG"></div>
       <div id="ballsWaveG_6" class="ballsWaveG"></div>
       <div id="ballsWaveG_7" class="ballsWaveG"></div>
       <div id="ballsWaveG_8" class="ballsWaveG"></div>
    </div>
</head>
<body>
  <script>
  	$( document ).ready(function() {
      $("#Menu").load("menu.html");  
	  });

    function extension_vrl(element) {
      var extName = new RegExp('vrl_.+nin$');
      return extName.test(element); 
    };

    const path = require('path');
    var exec = require('child_process').exec;
    var runperl = path.join("perlfiles","tmp_db.bat");
    var commrun = "perl " + path.join(process.cwd(),'VD','bin','get_version.pl ');

    create_analysisbat(runperl, commrun);

    exec(runperl, function(error,stdout,stderr){
        if(error!=null){
          console.log('error :', error);
          document.getElementById("running").innerHTML = 'Something went wrong readying external database version. ' + error;
        } else{
          document.getElementById("version").value = stdout;
          console.log("output:" + stdout);
        }
      }); 

    var fs = require('fs');

    fs.readdir(path.join(process.cwd(),"VD","databases"), function(err, items) {
        items.filter(extension_vrl).forEach(function(value) {
          document.getElementById("currentv").value += value + "\n";
        });
    });

  </script>


  <div id="Menu"></div>
<!-- Use any element to open the sidenav -->
  <span onclick="openNav()">Menu</span>
  <div id="main">
    <div class="container" id="container">
	  <label>Current local NCBI Database version</label><br>
    <textarea type="text" id="currentv" name="currentv" placeholder="">No database available.</textarea>
    <br><br>
    <label>Update to NCBI Database version</label><br>
	  <input type="text" id="version" name="version" placeholder="">
	  <br>
    <label>Organism</label><br>
            <select  class="form-control" id="organism" name="organism">
              <option value=""></option>
              <option value="plant">Plant</option>
              <option value="algae">Algae</option>
              <option value="bacteria">Bacteria</option>
              <option value="fungus">Fungus</option>
              <option value="invertebrate">Invertebrate</option>
              <option value="protozoa">Protozoa</option>
              <option value="vertebrate">Vertebrate</option>
            </select><br>
    <label>Select redundancy level</label><br>
            <select  class="form-control" id="filtering" name="filtering">
              <option value=""></option>
              <option value="U95">U95</option>
              <option value="U95">U97</option>
              <option value="U95">U100</option>
            </select><br>
	  
	  <input type="submit" id="Update" value="Update" onclick="update_db('organism','filtering','version')">
	  <br><label id="running"></label>
	</div>
  </div>

</body>
</html>