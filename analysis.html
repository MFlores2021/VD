<!DOCTYPE html>
<html>
<head>
	<title>
		Analysis
	</title>
<!-- 	    <style>
      #holder { border: 10px dashed #ccc; width: 300px; height: 300px; margin: 20px auto;}
      #holder.hover { border: 10px dashed #333; }
    </style> -->
</head>
    <script>

      //Same as $(document).ready();
      function ready(fn) {
        if (document.readyState != 'loading'){
          fn();
        } else {
          document.addEventListener('DOMContentLoaded', fn);
        }
      }

      //When the page has loaded, run this code
  //     ready(function(){
  //       // prevent default behavior from changing page on dropped file
  //       window.ondragover = function(e) { e.preventDefault(); return false };
  //       // NOTE: ondrop events WILL NOT WORK if you do not "preventDefault" in the ondragover event!!
  //       window.ondrop = function(e) { e.preventDefault(); return false };

  //       const holder = document.getElementById('holder');
  //       holder.ondragover = function () { this.className = 'hover'; return false; };
  //       holder.ondragleave = function () { this.className = ''; return false; };

  //       holder.ondrop = function (e) {
		//   e.preventDefault();

	 // 		for (let i = 0; i < e.dataTransfer.files.length; ++i) {
		// 	  const item = e.dataTransfer.items[i];
		// 	  const entry = item.webkitGetAsEntry();

		// 	  if (entry.isFile) {
		// 	    const file = item.getAsFile();
		// 	    console.log(file);

	 //  			document.getElementById("outputtext").innerHTML += file.name +"\n";
	 //  			// holder.hide();

		// 	  } else if (entry.isDirectory) {
		// 	    // Do magic with directory
		// 	    const dir = item.getAsFile();
		// 	    console.log(dir);
		// 	  }
		// 	}
		//   return false;
		// };

		// var exec = require('child_process').exec; 
		// exec('mkdir aaa');

  //     });


	  function doClick() {
		  var el = document.getElementById("fileElem");
		  if (el) {
		    el.click(); 
		  }
		  el.addEventListener("change", handleFiles, false);
	  }
	  //require('nw.gui').Window.get().showDevTools();
	  function handleFiles() {
		  var fileList = this.files;
		  var exec = require('child_process').exec; 
		  exec("C:/Users/User/Documents/perlfiles/portableshell.bat", function(error,stdout,stderr){
			console.log('stdout :', stdout); 
			console.log('stderr :', stderr); 
			if(error!=null){
				console.log('error :', error);
			}
		  });

		  if(fileList.length>0){
		  	exec('mkdir aaa'); 
		  }

		  for (var i = 0; i < fileList.length; i++) { good
			  var file = fileList[i].path;
			  var commcp ='copy ' + file + '  aaa\\';
			  exec(commcp); 	  
			  var commrun ='perl VD-master\\virus_detect.pl aaa\\' + fileList[i].name; 
			  exec(commrun, function(error,stdout,stderr){
			console.log('stdout :', stdout); 
			console.log('stderr :', stderr); 
			if(error != null){
				console.log('error :', error); 
			}
		  });
			  document.getElementById("outputtext").innerHTML += fileList[i].name +"\n";
		  }
	  }

	  function submit_files(fileList){
	  	exec("c:/Documents/perlfiles/portableshell.bat");
		  for (var i = 0; i < fileList.length; i++) {
			  var file = fileList[i].path;
			  exec('cp ' + file + '  aaa/'); 
			  
			  exec('perl virus_detect.pl aaa/' + fileList[i].name);
		  }	  	
	  }



  </script>

<body>
	<form>
	  <input type="file" id="fileElem" multiple="true" style="display:none" onchange="handleFiles(this.files)">
		<textarea id="outputtext"></textarea>
	</form>
	<a href="javascript:doClick()">Select some files</a>		


	<form>
	  Select database<br>
	  <input type="text" name="database" value="">
	  <br>
	  Select host reference<br>
	  <input type="text" name="reference" value="">
	  <br><br>
	  <input type="submit" value="Submit">
	</form> 


</body>
</html>